{% extends "accounts/base.html" %}

{% block title %}{{ cours.titre }}{% endblock %}

{% block content %}
<style>
    .course-detail {
        background-color: #fff;
        padding: 30px;
        border-radius: 8px;
        box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        margin-bottom: 30px;
    }

    .course-header {
        border-bottom: 2px solid #3498db;
        padding-bottom: 10px;
        margin-bottom: 20px;
    }

    .course-header h2 {
        margin: 0;
        color: #2c3e50;
    }

    .prof-name {
        color: #7f8c8d;
        font-style: italic;
    }

    .description {
        line-height: 1.6;
        color: #333;
    }

    /* Comments Section */
    .comments-section {
        margin-top: 40px;
    }

    .comment-list {
        list-style: none;
        padding: 0;
    }

    .comment-item {
        background: #f9f9f9;
        border: 1px solid #e0e0e0;
        border-radius: 6px;
        padding: 15px;
        margin-bottom: 15px;
    }

    .comment-meta {
        display: flex;
        justify-content: space-between;
        font-size: 0.85em;
        color: #7f8c8d;
        margin-bottom: 8px;
    }

    .comment-author {
        font-weight: bold;
        color: #2980b9;
    }

    .comment-form textarea {
        width: 100%;
        padding: 10px;
        border: 1px solid #ccc;
        border-radius: 4px;
        min-height: 80px;
        margin-bottom: 10px;
        font-family: inherit;
    }

    .btn-submit {
        background-color: #2ecc71;
        color: white;
        padding: 10px 20px;
        border: none;
        border-radius: 4px;
        cursor: pointer;
    }

    .btn-submit:hover {
        background-color: #27ae60;
    }

    .back-link {
        display: inline-block;
        margin-bottom: 20px;
        color: #3498db;
        text-decoration: none;
    }
</style>

<a href="javascript:history.back()" class="back-link">‚Üê Retour</a>

<div class="course-detail">
    <div class="course-header">
        <h2>{{ cours.titre }}</h2>
        <span class="prof-name">Prof. {{ cours.prof_prenom }} {{ cours.prof_nom }}</span>
    </div>

    <div class="description">
        <p><strong>Niveau:</strong> {{ cours.niveau }} ({{ cours.niveau_diff }})</p>
        <p><strong>Cat√©gorie:</strong> {{ cours.categorie }}</p>
        <hr>
        <p>{{ cours.description|linebreaks }}</p>
    </div>
</div>

{% if user.role == 'STUDENT' %}
<div class="inscription-section" style="margin-top: 20px; padding: 20px; background: #e8f8f5; border-radius: 8px;">
    {% if inscription_status == "ACCEPTEE" %}
    <div style="color: #27ae60; font-weight: bold;">
        ‚úì Vous √™tes inscrit √† ce cours.
    </div>
    {% elif inscription_status == "EN_ATTENTE" %}
    <div style="color: #f39c12; font-weight: bold;">
        üïí Votre demande d'inscription est en attente de validation.
    </div>
    {% elif inscription_status == "REFUSEE" %}
    <div style="color: #c0392b; font-weight: bold;">
        ‚úï Votre demande d'inscription a √©t√© refus√©e.
    </div>
    {% else %}
    <form action="{% url 'demander_inscription_cours' cours.id %}" method="POST" style="display: inline;">
        {% csrf_token %}
        <button type="submit" class="btn-submit">S'inscrire √† ce cours</button>
    </form>
    {% endif %}
</div>
{% endif %}

<div class="comments-section">
    <h3>Discussions</h3>

    <form method="POST" class="comment-form">
        {% csrf_token %}
        <textarea name="message" placeholder="Poser une question ou laisser un commentaire..." required></textarea>
        <button type="submit" class="btn-submit">Envoyer</button>
    </form>

    <ul class="comment-list">
        {% for comment in commentaires %}
        <li class="comment-item">
            <div class="comment-meta">
                <span class="comment-author">{{ comment.auteur_prenom }} {{ comment.auteur_nom }}</span>
                <span>{{ comment.date_message|date:"d M Y H:i" }}</span>
            </div>
            <div class="comment-body">
                {{ comment.message|linebreaks }}
            </div>
        </li>
        {% empty %}
        <li style="color: #7f8c8d; font-style: italic;">Aucun commentaire pour le moment. Soyez le premier !</li>
        {% endfor %}
    </ul>
</div>

{% endblock %}